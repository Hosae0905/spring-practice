## 스프링 핵심 원리 이해2 - 객체 지향 원리 적용

### 새로운 할인 정책 개발
- 유연한 설계를 잘 해놓으면 의사결정이 변경되더라도 쉽게 변경이 가능하다.

### 새로운 할인 정책 적용과 문제점
- 할인 정책을 변경하려면 클라이언트인 OrderServiceImpl 코드를 고쳐야 한다.
- 역할과 구현을 충실하게 분리했고, 다형성도 활용하고 인터페이스와 구현 객체를 분리했다.
- 하지만 OCP, DIP 같은 객체지향 설계 원칙을 충실히 준수하지 않았다.
- 왜냐하면 구현 클래스에도 의존을 하고 있기 때문이다.
- 해결 방법
  - 인터페이스만 의존하도록 설계를 변경한다.
  - 하지만 구현체 없이 인터페이스만 가지고 실행할 수 없다.(NullPointerException 발생)
  - 따라서 누군가가 클라이언트인 OrderServiceImpl 클래스에 DiscountPolicy의 구현 객체를 대신 생성하고 주입해줘야 한다.

### 관심사 분리
- 관심사를 분리하자
  - 다양한 책임을 가지게 하지 말자. (단일 책임만 가지게 하자)
  - 본인의 역할을 수행하는 것에만 집중해야 한다.
  - 상대 역할이 다른 사람으로 바뀌어도 똑같이 애플리케이션이 구동되야 한다.
  - 각각의 역할을 지정해주는 공연 기획자와 같은 사람이 있어야 한다.
  - 공연 기획자를 만들고 책임을 확실히 분리하자.
  - 배우는 자기가 맡은 역할에만 집중하기
- AppConfig
  - 애플리케이션의 전체 동작 방식을 구성(config)하기 위해 구현 객체를 생성하고, 연결하는 책임을 가지는 별도의 설정 클래스이다.
  - AppConfig는 애플리케이션의 실제 동작에 필요한 구현 객체를 생성한다.
  - 생성한 객체 인스턴스의 참조를 생성자를 통해서 주입(연결) 해준다.
  - 의존관계에 대한 고민은 외부에 맡기고 실행에만 집중하면 된다.
  - 클라이언트 입장에서 의존관계를 마치 외부에서 주입해주는 것 같다고 해서 의존성 주입이라고 한다.
  - 어떤 구현 객체를 주입할지는 오직 외부(AppConfig)에서 결정한다.
- 구성 정보에는 역할과 구현이 한 눈에 보여야 한다.

### 새로운 구조와 할인 정책 적용
- 할인 정책을 변경하려면 AppConfig만 변경하면 된다.
- AppConfig를 통해서 애플리케이션이 크게 사용 영역과 객체를 생성하고 구성하는 영역으로 분리되었다.
- 구성 영역은 당연히 변경된다. (공연 기획자라고 생각하자.)
- DIP와 OCP를 모두 지킬 수 있다. (할인 정책을 변경해도 기존 클라이언트 코드에는 변경이 없다.)

### IoC, DI, 컨테이너
- IoC(제어의 역전)
  - 프레임워크가 대신 객체를 생성하고 연결해주는 등 프로그램의 제어 흐름을 개발자가 아닌 프레임워크가 하는 것
- 프레임워크와 라이브러리
  - 프레임워크가 내가 작성한 코드를 제어하고 대신 실행하면 그것은 프레임워크
  - 반면에 내가 작성한 코드가 직접 제어의 흐름을 담당한다면 그것은 라이브러리
- DI(의존성 주입)
  - 의존관계는 정적인 클래스 의존 관계와 실행 시점에 결정되는 동적인 객체(인스턴스) 의존 관계 이 둘을 분리해서 생각해야 한다.
  - 정적인 클래스 의존관계
    - 클래스가 사용하는 import 코드만 보고 의존관계를 쉽게 판단할 수 있다. 정적인 의존관계는 애플리케이션을 실행하지 않아도 분석할 수 있다.
    - 하지만 이러한 클래스는 의존관계 만으로는 실제 어떤 객체가 주입 될지 알 수 없다.
  - 동적인 객체 인스턴스 의존 관계
    - 애플리케이션 실행 시점(런타임)에 외부에서 실제 구현 객체를 생성하고 클라이언트에 전달해서 클라이언트와 서버의 실제 의존관계가 연결 되는 것을 의존관계 주입이라고 한다.
    - 객체 인스턴스를 생성하고 그 참조값을 전달해서 연결된다.
    - 의존관계 주입을 사용하면 클라이언트 코드를 변경하지 않고 클라이언트가 호출하는 대상의 타입 인스턴스를 변경할 수 있다.
    - 의존관계 주입을 사용하면 정적인 클래스 의존관계를 변경하지 않고 동적인 객체 인스턴스 의존관계를 쉽게 변경할 수 있다.
- IoC 컨테이너, DI 컨테이너
  - AppConfig 처럼 객체를 생성하고 관리하면서 의존관계를 연결해 주는 것을 IoC 컨테이너 또는 DI 컨테이너라고 한다.
  - 주로 DI 컨테이너라고 한다.

### 스프링으로 전환하기
- 스프링 컨테이너에 생성한 객체들을 관리해준다.
- 자바의 리플렉션을 같이 공부하면 더 이해가 좋을 것 같다.
- ApplicationContext를 스프링 컨테이너라고 한다.
- 스프링 컨테이너
  - 기존에는 개발자가 직접 DI를 해줬다면 스프링 컨테이너가 대신 해준다.
  - 스프링 컨테이너는 @Configuration이 붙은 AppConfig를 설정 정보로 사용한다. 해당 클래스에서 @Bean이라 적힌 메서드를 모두 호출해서 반환된 객체를 스프링 컨테이너에 등록한다.
  - 이렇게 스프링 컨테이너에 등록된 객체를 스프링 빈이라 한다.
  - AppConfig에서 조회하는 것이 아닌 스프링 컨테이너에서 필요한 객체를 직접 찾아야 한다.
- 스프링 컨테이너의 장점은 무엇일까?
- 
